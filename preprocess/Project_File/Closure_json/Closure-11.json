{"id":810,"status":"Fixed","summary":"Record type invalid property not reported on function with @this annotation","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":4,"comments":[{"id":0,"commenterId":-2236042086396273250,"content":"Code:\r\n\r\nvar makeClass \u003d function(protoMethods) {\r\n  var clazz \u003d function() {\r\n    this.initialize.apply(this, arguments);\r\n  }\r\n  for (var i in protoMethods) {\r\n    clazz.prototype[i] \u003d protoMethods[i];\r\n  }\r\n\r\n  return clazz;\r\n}\r\n\r\n/**\r\n * @constructor\r\n * @param {{name: string, height: number}} options\r\n */\r\nvar Person \u003d function(options){};\r\nPerson \u003d makeClass(/** @lends Person.prototype */ {\r\n  /**\r\n   * @this {Person}\r\n   * @param {{name: string, height: number}} options\r\n   */\r\n  initialize: function(options) {\r\n    /** @type {string} */ this.name_ \u003d options.thisPropDoesNotExist;\r\n  },\r\n\r\n  /**\r\n   * @param {string} message\r\n   * @this {Person}\r\n   */\r\n  say: function(message) {\r\n    window.console.log(this.name_ + \u0027 says: \u0027 + message);\r\n  }\r\n});\r\n\r\n\r\nvar joe \u003d new Person({name: \u0027joe\u0027, height: 300});\r\njoe.say(\u0027hi\u0027);\r\n\r\n\r\ncompiled with:\r\njava -jar build/compiler.jar --formatting\u003dPRETTY_PRINT --jscomp_error\u003dcheckTypes --jscomp_error\u003dexternsValidation --compilation_level\u003dSIMPLE_OPTIMIZATIONS repro.js\r\n\r\n\r\nI would expect an error on this line:\r\n    /** @type {string} */ this.name_ \u003d options.thisPropDoesNotExist;\r\n\r\nwhich works in other contexts.\r\n\r\nThanks!\r\n","timestamp":1346880951,"attachments":[]},{"id":1,"commenterId":-7699928860083865744,"content":"Here\u0027s a much simpler repro case:\r\n\r\n/**\r\n * @constructor\r\n */\r\nvar Person \u003d function(){};\r\nPerson.prototype.bar \u003d function(options) {\r\n  this.x \u003d options.thisPropDoesNotExist;\r\n};\r\n\r\nsomething very weird is going on, because making very small changes make the warning appear (i.e., changing \"options.thisPropDoesNotExist\" to \"+ options.thisPropDoesNotExist\"","timestamp":1347371555,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"oh, i see the problem. by some weird coincidence, dimitris pointed this out to me yesterday.","timestamp":1347371893,"attachments":[]},{"id":3,"commenterId":1328304962299559429,"content":"This issue was closed by revision r2185.","timestamp":1347561611,"attachments":[]}]}