{"id":1085,"status":"Fixed","summary":"Crash on the web closure compiler","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":7,"comments":[{"id":0,"commenterId":8314034250437663610,"content":"With the web application (http://closure-compiler.appspot.com/home)\r\n\r\nConfig:\r\n\r\n// \u003d\u003dClosureCompiler\u003d\u003d\r\n// @output_file_name default.js\r\n// @compilation_level ADVANCED_OPTIMIZATIONS\r\n// \u003d\u003d/ClosureCompiler\u003d\u003d\r\n\r\n\r\nCode:\r\n\r\nvar g\u003dfunction(m){return m*Math.random()|0},d\u003ddocument,h\u003dd.getElementById(\u0027h\u0027),c\u003dd.getElementById(\u0027c\u0027),l;\r\n(l\u003dfunction(){requestAnimationFrame(l);h.style.textShadow\u003d\u0026quot;0 0 1px #000,\u0026quot;+(g(10)-5)+\u0026quot;px \u0026quot;+(g(10)-5)+\u0026quot;px 0 #888,0 0 180px rgb(\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;)\u0026quot;})();\r\nd.addEventListener(\u0027mousemove\u0027,function(v){c.style.marginTop\u003d(v.pageY/10+15|0)+\u0027px\u0027})\r\n\r\n\r\nCause:\r\n\r\nvar l; // DÃ©clare l variable\r\n\r\n// Store function in l var and call\r\n(l \u003d function(){ ... })       ();\r\n\r\n\r\nCrash repport: (long)\r\n\r\n23: java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\nPlease report this problem.\r\nUnexpected variable l\r\n  Node(NAME l): Input_0:2:36\r\n(l\u003dfunction(){requestAnimationFrame(l);h.style.textShadow\u003d\u0026quot;0 0 1px #000,\u0026quot;+(g(10)-5)+\u0026quot;px \u0026quot;+(g(10)-5)+\u0026quot;px 0 #888,0 0 180px rgb(\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;)\u0026quot;})();\r\n  Parent(CALL): Input_0:2:14\r\n(l\u003dfunction(){requestAnimationFrame(l);h.style.textShadow\u003d\u0026quot;0 0 1px #000,\u0026quot;+(g(10)-5)+\u0026quot;px \u0026quot;+(g(10)-5)+\u0026quot;px 0 #888,0 0 180px rgb(\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;,\u0026quot;+g(255)+\u0026quot;)\u0026quot;})();\r\n\r\n\tat com.google.javascript.jscomp.VarCheck.visit(VarCheck.java:159)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:544)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:538)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:538)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:538)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:538)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseRoots(NodeTraversal.java:318)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseRoots(NodeTraversal.java:507)\r\n\tat com.google.javascript.jscomp.VarCheck.process(VarCheck.java:102)\r\n\tat com.google.javascript.jscomp.PhaseOptimizer$NamedPass.process(PhaseOptimizer.java:271)\r\n\tat com.google.javascript.jscomp.PhaseOptimizer.process(PhaseOptimizer.java:215)\r\n\tat com.google.javascript.jscomp.Compiler.optimize(Compiler.java:1918)\r\n\tat com.google.javascript.jscomp.Compiler.compileInternal(Compiler.java:751)\r\n\tat com.google.javascript.jscomp.Compiler.access$000(Compiler.java:85)\r\n\tat com.google.javascript.jscomp.Compiler$2.call(Compiler.java:652)\r\n\tat com.google.javascript.jscomp.Compiler$2.call(Compiler.java:649)\r\n\tat com.google.javascript.jscomp.Compiler.runInCompilerThread(Compiler.java:709)\r\n\tat com.google.javascript.jscomp.Compiler.compile(Compiler.java:649)\r\n\tat com.google.javascript.jscomp.Compiler.compile(Compiler.java:605)\r\n\tat com.google.javascript.jscomp.webservice.backend.CompilerInvokerImpl.compile(CompilerInvokerImpl.java:47)\r\n\tat com.google.javascript.jscomp.webservice.backend.ServerController.executeRequest(ServerController.java:174)\r\n\tat com.google.javascript.jscomp.webservice.backend.CompilationRequestHandler.serviceParsedRequest(CompilationRequestHandler.java:180)\r\n\tat com.google.javascript.jscomp.webservice.backend.CompilationRequestHandler.service(CompilationRequestHandler.java:162)\r\n\tat com.google.javascript.jscomp.webservice.frontend.CompilationServlet.doPost(CompilationServlet.java:83)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:637)\r\n\tat javax.servlet.http.HttpServlet.service(HttpServlet.java:717)\r\n\tat org.mortbay.jetty.servlet.ServletHolder.handle(ServletHolder.java:511)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1166)\r\n\tat com.google.apphosting.utils.servlet.ParseBlobUploadFilter.doFilter(ParseBlobUploadFilter.java:125)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\r\n\tat com.google.apphosting.runtime.jetty.SaveSessionFilter.doFilter(SaveSessionFilter.java:35)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\r\n\tat com.google.apphosting.utils.servlet.JdbcMySqlConnectionCleanupFilter.doFilter(JdbcMySqlConnectionCleanupFilter.java:60)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\r\n\tat com.google.apphosting.utils.servlet.TransactionCleanupFilter.doFilter(TransactionCleanupFilter.java:43)\r\n\tat org.mortbay.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1157)\r\n\tat org.mortbay.jetty.servlet.ServletHandler.handle(ServletHandler.java:388)\r\n\tat org.mortbay.jetty.security.SecurityHandler.handle(SecurityHandler.java:216)\r\n\tat org.mortbay.jetty.servlet.SessionHandler.handle(SessionHandler.java:182)\r\n\tat org.mortbay.jetty.handler.ContextHandler.handle(ContextHandler.java:765)\r\n\tat org.mortbay.jetty.webapp.WebAppContext.handle(WebAppContext.java:418)\r\n\tat com.google.apphosting.runtime.jetty.AppVersionHandlerMap.handle(AppVersionHandlerMap.java:266)\r\n\tat org.mortbay.jetty.handler.HandlerWrapper.handle(HandlerWrapper.java:152)\r\n\tat org.mortbay.jetty.Server.handle(Server.java:326)\r\n\tat org.mortbay.jetty.HttpConnection.handleRequest(HttpConnection.java:542)\r\n\tat org.mortbay.jetty.HttpConnection$RequestHandler.headerComplete(HttpConnection.java:923)\r\n\tat com.google.apphosting.runtime.jetty.RpcRequestParser.parseAvailable(RpcRequestParser.java:76)\r\n\tat org.mortbay.jetty.HttpConnection.handle(HttpConnection.java:404)\r\n\tat com.google.apphosting.runtime.jetty.JettyServletEngineAdapter.serviceRequest(JettyServletEngineAdapter.java:146)\r\n\tat com.google.apphosting.runtime.JavaRuntime$RequestRunnable.run(JavaRuntime.java:439)\r\n\tat com.google.tracing.TraceContext$TraceContextRunnable.runInContext(TraceContext.java:435)\r\n\tat com.google.tracing.TraceContext$TraceContextRunnable$1.run(TraceContext.java:442)\r\n\tat com.google.tracing.CurrentContext.runInContext(CurrentContext.java:186)\r\n\tat com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContextNoUnref(TraceContext.java:306)\r\n\tat com.google.tracing.TraceContext$AbstractTraceContextCallback.runInInheritedContext(TraceContext.java:298)\r\n\tat com.google.tracing.TraceContext$TraceContextRunnable.run(TraceContext.java:439)\r\n\tat com.google.apphosting.runtime.ThreadGroupPool$PoolEntry.run(ThreadGroupPool.java:251)\r\n\tat java.lang.Thread.run(Thread.java:722)\r\nCaused by: java.lang.IllegalStateException: Unexpected variable l\r\n\t... 58 more\r\n\r\nOriginal Post Data: \r\noutput_format\u003djson\u0026amp;output_info\u003dcompiled_code\u0026amp;output_info\u003dwarnings\u0026amp;output_info\u003derrors\u0026amp;output_info\u003dstatistics\u0026amp;compilation_level\u003dADVANCED_OPTIMIZATIONS\u0026amp;warning_level\u003dverbose\u0026amp;output_file_name\u003ddefault.js\u0026amp;js_code\u003dvar%20g%3Dfunction(m)%7Breturn%20m*Math.random()%7C0%7D%2Cd%3Ddocument%2Ch%3Dd.getElementById(\u0027h\u0027)%2Cc%3Dd.getElementById(\u0027c\u0027)%2Cl%3B%0A(l%3Dfunction()%7BrequestAnimationFrame(l)%3Bh.style.textShadow%3D%220%200%201px%20%23000%2C%22%2B(g(10)-5)%2B%22px%20%22%2B(g(10)-5)%2B%22px%200%20%23888%2C0%200%20180px%20rgb(%22%2Bg(255)%2B%22%2C%22%2Bg(255)%2B%22%2C%22%2Bg(255)%2B%22)%22%7D)()%3B%0Ad.addEventListener(\u0027mousemove\u0027%2Cfunction(v)%7Bc.style.marginTop%3D(v.pageY%2F10%2B15%7C0)%2B\u0027px\u0027%7D)\r\n","timestamp":1378388694,"attachments":[]},{"id":1,"commenterId":-5060162230523776870,"content":"Thank you for the repro case.","timestamp":1378416282,"attachments":[]},{"id":2,"commenterId":-5060162230523776870,"content":"Looks like a \"smart name removal\" problem. I think I\u0027m going to rename that pass to \"dumb name removal\"","timestamp":1380069203,"attachments":[]},{"id":3,"commenterId":-5060162230523776870,"content":"","timestamp":1380562075,"attachments":[]},{"id":4,"commenterId":4865484112040790759,"content":"I minimized the repro case to this.\r\n\r\nvar l;\r\n(l \u003d function(){ l; })();\r\n\r\nThanks for the report, I\u0027ll take a look.","timestamp":1380566792,"attachments":[]},{"id":5,"commenterId":-8769171937076622550,"content":"This issue was closed by revision 5f03c6817341.","timestamp":1380849720,"attachments":[]},{"id":6,"commenterId":-8769171937076622550,"content":"This issue was closed by revision 5f03c6817341.","timestamp":1381947640,"attachments":[]}]}