{"id":668,"status":"Fixed","summary":"goog.addSingletonGetter prevents unused class removal","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":3,"comments":[{"id":0,"commenterId":-5060162230523776870,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n\r\n// \u003d\u003dClosureCompiler\u003d\u003d\r\n// @compilation_level ADVANCED_OPTIMIZATIONS\r\n// @output_file_name default.js\r\n// @use_closure_library true\r\n// @formatting pretty_print,print_input_delimiter\r\n// @warning_level VERBOSE\r\n// @debug true\r\n// \u003d\u003d/ClosureCompiler\u003d\u003d\r\n\r\ngoog.provide(\u0027foo\u0027);\r\n\r\nvar foo \u003d function() { this.values \u003d []; };\r\ngoog.addSingletonGetter(foo);\r\n\r\nfoo.prototype.add \u003d function(value) {this.values.push(value)};\r\n\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\nExpect: The code is completely removed.\r\n\r\nInstead:\r\n\r\n(function($ctor$$) {\r\n  $ctor$$.$getInstance$ \u003d function $$ctor$$$$getInstance$$() {\r\n    return $ctor$$.$instance_$ || ($ctor$$.$instance_$ \u003d new $ctor$$)\r\n  }\r\n})(function() {\r\n});\r\n\r\n\r\nWhat version of the product are you using? On what operating system?\r\n\r\nhttp://closure-compiler.appspot.com on Feb 28, 2012\r\n\r\nPlease provide any additional information below.\r\n\r\n\r\n","timestamp":1330445813,"attachments":[]},{"id":1,"commenterId":6454800031398885070,"content":"The failure sequence is like this:\r\n1) remove unused prototype properties removes the properties\r\n2) inlineVariables moves the constructor into the goog.addSingletonGetter call\r\n3) NameAnalyzer won\u0027t remove it because it has no name \r\n4) goog.addSingletonGetter has side-effect so it won\u0027t be removed on its own.\r\n","timestamp":1330471666,"attachments":[]},{"id":2,"commenterId":1328304962299559429,"content":"This issue was closed by revision r1800.","timestamp":1330546467,"attachments":[]}]}