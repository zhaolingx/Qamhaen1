{"id":501,"status":"Fixed","summary":"Closure removes needed code.","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":7,"comments":[{"id":0,"commenterId":-3185848331994252003,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n1. Try the following code, in Simple mode\r\nMath.blah \u003d function(test) { test.a \u003d 5; };\r\nvar test \u003d new Object();\r\nMath.blah(test); \r\n2. The output is\r\nMath.blah\u003dfunction(a){a.a\u003d5};var test\u003d{};\r\n\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\nNote that Math.blah(test) was removed. It should not be. It issues a warning: JSC_USELESS_CODE: Suspicious code. This code lacks side-effects. Is there a bug? at line 4 character 9\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\nTested on Google hosted Closure service.\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\nClosure seems to be protective about Math in particular, and doesn\u0027t like people messing around with her? So, when I try the following code:-\r\nvar n \u003d {};\r\nn.blah \u003d function(test) { test.a \u003d 5; };\r\nvar test \u003d new Object();\r\nn.blah(test);\r\n\r\nIt works. When I replace n by Math, then again, Closure kicks out blah. I need that poor fellow. Please talk some sense into it.","timestamp":1309210135,"attachments":[]},{"id":1,"commenterId":6454800031398885070,"content":"There is some code in NodeUtil\u0027s side-effect detection code that assumes all Math.xxx lack side-effects.  An easy work around in simple mode is the assign the result of the function (even if it undefined) to a global variable.  In advanced mode, goog.reflect.sinkValue can be used.    It would make more sense however to white-list known Math methods, rather than assume they are all side-effect free (or simply don\u0027t assume anything and rely on the externs ).","timestamp":1309222651,"attachments":[]},{"id":2,"commenterId":-3185848331994252003,"content":"Fine. Also it seems that if I wrap the given code in a function and assign the output of Math.seedrandom() to some local variable then that line is removed, but warning is given. This seems to happen for Math only.","timestamp":1309237603,"attachments":[]},{"id":3,"commenterId":-7699928860083865744,"content":"","timestamp":1309277180,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1222.","timestamp":1309305961,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1226.","timestamp":1309464273,"attachments":[]},{"id":6,"commenterId":1328304962299559429,"content":"This issue was closed by revision r1234.","timestamp":1309464790,"attachments":[]}]}